<%= form_for @checkpoint, url: {action: @checkpoint.new_record? ? :create : :update} do |f| %>

  <%= render partial: "errors", locals: {object: @checkpoint} %>

  <table class="survey">
    <% parent_id = 0 %>
    <% count = 1 %>
    <% @checkpoint.checkpoint_answers && @checkpoint.checkpoint_answers.each_with_index do |checkpoint_answer, i| %>
      <% if checkpoint_answer.question.question_types.present? && 
        parent_id != checkpoint_answer.question.question_types.try(:first).id %>
        <tr>
          <td colspan = 2 style = "padding-left:2%;" ><label><%= count %>.
          <%= checkpoint_answer.question.question_types.try(:first).name %></label></td>
        </tr>
        <% parent_id = checkpoint_answer.question.question_types.try(:first).id %>
        <% count += 1 %>
      <% end %>

      <%= render "answer_fields", {checkpoint_answer: checkpoint_answer, f: f, i: count } %>

    <% end %>
  </table>

  <div class="form-actions" style = "background-color: #FFFFFF;">
    <% if @checkpoint.waitting? && current_user.is_leader? %>
      <%= f.button t(:button_finish, scope: [:views, :labels]), class: "btn btn-primary", 
        name: "#{model_name.underscore}[state_event]", value: "reviewed" %>
    <% else %>
      <%= f.button t(:button_finish, scope: [:views, :labels]), class: "btn btn-primary", 
        name: "#{model_name.underscore}[state_event]", value: "reviewing" %>
    <% end %>
  </div>
<% end %>

